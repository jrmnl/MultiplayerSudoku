<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <title>Main</title>
  <script src="main.js"></script>
</head>

<body>
  <div id="elm"></div>
  <script>
  var app = Elm.Main.init({
    node: document.getElementById('elm')
  });
  
  // step 1: hook up outgoing port
  var ws = {}
  app.ports.send.subscribe(function(msg) {
	try {
	  console.log('[js] send', msg);
	  ws.conn.send(msg);
	} catch (e) {
	  console.log('[js] send fail', e); // e.g. ws.conn not established
	}
  });
  function connectWebSocket(app, wsUrl, optionalProtocol) {
	ws.conn = new WebSocket(wsUrl, optionalProtocol);
	ws.conn.onopen = function (event) {
		console.log('[js] connected', event);
	};
	ws.conn.onmessage = function (event) {
		console.log('[js] message', event);
		app.ports.recieve.send(event.data);
	};
	ws.conn.onerror = function (event) {
		console.log('[js] error', event);
	};
	ws.conn.onclose = function (event) {
		console.log('[js] close', event);
		ws.conn.onclose = null;
		ws.conn = null;
		//setTimeout(function() {
		//  connectWebSocket(app, wsUrl, optionalProtocol);
		//}, 1000);
	};
  }
  // step 2: hook up incoming port
  // e.g.
  connectWebSocket(app, 'ws://localhost:8001/api/sudoku/start');
  // or if we're doing https://github.com/graph-gophers/graphql-transport-ws
  // connectWebSocket(app, 'ws://localhost:5000/graphql', 'graphql-ws');
  </script>
</body>
</html>